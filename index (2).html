<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>360 Crop Viewer Builder</title>
<style>
body {
    margin: 0;
    padding: 20px;
    background: #111;
    color: #fff;
    font-family: system-ui, sans-serif;
}
h1 { font-size: 20px; margin-bottom: 10px; }
input, button, textarea {
    width: 100%;
    margin-top: 10px;
}
button {
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
}
textarea {
    height: 260px;
    font-family: monospace;
}
</style>
</head>
<body>

<h1>1:1 360 Crop Viewer Generator</h1>
<input type="file" id="file" accept="image/*">
<button onclick="generate()">Generate & Download HTML</button>
<textarea id="output" placeholder="Generated HTML preview (optional)"></textarea>

<script>
function generate() {
    const file = document.getElementById("file").files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        const img = reader.result;

        const html = `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
<title>360 Viewer</title>
<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: black;
}
#viewer {
    position: absolute;
    inset: 0;
    background: url("${img}") no-repeat center;
    background-size: cover;
    touch-action: none;
}
</style>
</head>
<body>

<div id="viewer"></div>

<script>
const v = document.getElementById("viewer");
let start = 0;
let pos = 50;
let horizontal = true;
let dragging = false;

function mode() {
    horizontal = innerWidth >= innerHeight;
}

function update() {
    pos = Math.max(0, Math.min(100, pos));
    v.style.backgroundPosition = horizontal
        ? pos + "% 50%"
        : "50% " + pos + "%";
}

v.addEventListener("mousedown", e => {
    dragging = true;
    start = horizontal ? e.clientX : e.clientY;
});

v.addEventListener("mousemove", e => {
    if (!dragging) return;
    const now = horizontal ? e.clientX : e.clientY;
    pos += (start - now) * 0.05;
    start = now;
    update();
});

["mouseup","mouseleave"].forEach(ev =>
    v.addEventListener(ev, () => dragging = false)
);

v.addEventListener("touchstart", e => {
    start = horizontal ? e.touches[0].clientX : e.touches[0].clientY;
});

v.addEventListener("touchmove", e => {
    const now = horizontal ? e.touches[0].clientX : e.touches[0].clientY;
    pos += (start - now) * 0.05;
    start = now;
    update();
});

addEventListener("resize", () => {
    mode();
    update();
});

mode();
update();
<\/script>

</body>
</html>`;

        document.getElementById("output").value = html;

        const blob = new Blob([html], { type: "text/html" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "360_viewer.html";
        a.click();
        URL.revokeObjectURL(a.href);
    };
    reader.readAsDataURL(file);
}
</script>

</body>
</html>
